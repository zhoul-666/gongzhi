# 绩效核算系统 - 项目目的和要求

> **说明**：每次开始任务前请先阅读本文件，快速了解项目背景和核心要求

---

## 一、项目概述

为公司人事部开发的**绩效核算工具**，用于每月计算生产岗位同事的绩效工资。

| 项目 | 说明 |
|-----|------|
| 形式 | Streamlit 网页版 |
| 部署 | 公司内网 Mac Mini 服务器 |
| 用户 | 人事部 1 人，每月使用一次 |
| 人员规模 | 约 30 人 |

---

## 二、交付物标准（4个特征）

1. **可验证**：先不动数据库，先跑通算法，输出 Excel 做人工对账验证
2. **可配置**：绩效/计薪规则不是死公式，能通过配置组合出不同岗位的口径
3. **可接入**：验证通过后，再接入 PostgreSQL，把结果喂给现有系统
4. **可交接**：任何人拿到文档与验收数据，都能复现结果、继续迭代

---

## 三、三种模式

| 模式 | 说明 |
|-----|------|
| 门店 (mode_001) | 门店员工 |
| 中央工厂 (mode_002) | 大部分员工 |
| 喷印工厂 (mode_003) | 喷印相关员工 |

每个员工只属于一种模式，模式决定可选的小技能列表。

---

## 四、四个大区域

| 区域 | 对应ERP列名 |
|-----|------------|
| 印前 (region_001) | 印前处理分值 |
| 印中 (region_002) | 印中制作分值 |
| 印后 (region_003) | 印后加工分值 |
| 前台 (region_004) | 无绩效分 |

---

## 五、核心计算逻辑

### 技能工资计算
```
员工某项小技能的工资计算：
├── 第一步：是否通过考核？（管理员手动设置）
│   ├── 未通过考核 → 0元
│   └── 通过考核 → 进入第二步
│
└── 第二步：是否在岗？（按大区域绩效自动判断）
    ├── 该技能所属大区域的绩效 ≥ 达标值 → 在岗工资
    └── 该技能所属大区域的绩效 < 达标值 → 不在岗工资
```

### 阶梯奖金计算
- 每个大区域有独立的阶梯规则
- 按区间累计计算，区间内按比例
- 示例：绩效7万，在3-10万区间，比例=(7-3)/(10-3)=4/7

### 总工资
```
某区域小计 = 技能工资 + 阶梯奖金
总工资 = 印前小计 + 印中小计 + 印后小计 + 前台小计
```

---

## 六、数据来源

- **绩效数据**：从 ERP 系统导出 Excel（实际是HTML格式的xls）
- **关键列**：生产人员、印前处理分值、印中制作分值、印后加工分值
- **技能表**：`技能.xlsx` 包含三种模式的所有小技能

---

## 七、Claude 协作规范

### 沟通方式
- 用大白话解释，禁止使用专业术语
- 写代码前先讲清楚思路，确认后再动手
- 代码里加大量中文 `print()`，让程序"会说话"

### 文件安全
- **相对路径**：禁止绝对路径，只用 `./data` 这种
- **自动备份**：修改文件时自动备份到 `./backup`
- **命名格式**：`原文件名_YYYYMMDD_HHMMSS_v版本.扩展名`

### 错误处理
- 关键功能用 try-except 包裹
- 报错时输出中文提示
- 需要安装库时明确给出 `pip install xxx`

---

## 八、项目结构

```
gongzhi/
├── app/
│   ├── main.py              # 主程序入口
│   ├── data_manager.py      # 数据管理模块
│   └── pages/               # 各功能页面
├── data/                    # JSON数据文件
├── backup/                  # 自动备份目录
├── 01_项目目的和要求.md     # 本文件
├── 02_问题记录与解决.md     # 问题追踪
└── 03_接下来的工作.md       # 待办事项
```

---

## 九、运行方式

```bash
# 安装依赖
pip install -r requirements.txt

# 启动程序
python3 -m streamlit run app/main.py

# 访问地址
http://localhost:8501
```

---

*文档整理时间：2024年12月29日*
