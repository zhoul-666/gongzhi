# 绩效核算系统 - 1228第一次生成备份

> 生成时间：2024年12月28日
> 状态：第一阶段基本完成，部分功能待优化

---

## 一、项目概述

为公司人事部开发的**绩效核算工具**，用于每月计算生产岗位同事的绩效工资。

- **形式**：Streamlit 网页版
- **部署目标**：公司内网 Mac Mini 服务器
- **用户**：人事部 1 人，每月使用一次
- **人员规模**：约 30 人

---

## 二、已完成的功能

### 2.1 项目结构
```
gongzhi/
├── app/
│   ├── main.py              # 主程序入口
│   ├── data_manager.py      # 数据管理模块（增删改查+备份）
│   └── pages/
│       ├── employee_page.py     # 员工管理
│       ├── region_page.py       # 大区域管理（含阶梯规则）
│       ├── skill_page.py        # 小技能管理（含批量编辑）
│       ├── assignment_page.py   # 员工技能指派
│       ├── import_page.py       # 绩效导入
│       ├── calculate_page.py    # 绩效计算
│       └── history_page.py      # 历史查询
├── data/
│   ├── modes.json           # 模式数据（门店/中央工厂/喷印工厂）
│   ├── regions.json         # 大区域+阶梯规则
│   ├── skills.json          # 小技能数据
│   ├── employees.json       # 员工数据（已导入19人）
│   ├── employee_skills.json # 员工-技能关联
│   ├── performance.json     # 绩效数据（已导入12月数据）
│   ├── calculation_history.json # 计算历史
│   └── config.json          # 系统配置
├── backup/                  # 自动备份目录
├── requirements.txt         # 依赖列表
├── 1226工作进度沟通.md      # 需求文档
├── 1228执行前的沟通.md      # 详细需求确认
├── 技能.xlsx               # 技能表原始数据
└── 11月生产绩效统计-*.xls  # ERP绩效数据样本
```

### 2.2 已实现功能

| 功能 | 状态 | 说明 |
|-----|------|------|
| 员工管理 | ✅ 已完成 | 增删改查，支持模式切换 |
| 大区域管理 | ✅ 已完成 | 印前/印中/印后/前台，阶梯规则配置 |
| 小技能管理 | ✅ 已完成 | 按模式/区域筛选，批量修改工资 |
| 员工技能指派 | ✅ 已完成 | 分配技能、考核状态、自定义达标值 |
| 绩效导入 | ✅ 已完成 | 解析ERP Excel，自动创建员工 |
| 绩效计算 | ✅ 已完成 | 在岗判断+阶梯奖金+技能工资 |
| 历史查询 | ✅ 已完成 | 查看往月数据，月度对比，导出Excel |

### 2.3 运行方式
```bash
# 安装依赖
pip install -r requirements.txt

# 启动程序
python3 -m streamlit run app/main.py

# 访问地址
http://localhost:8501
```

---

## 三、核心业务逻辑

### 3.1 三种模式
- **门店** (mode_001)
- **中央工厂** (mode_002) - 大部分员工
- **喷印工厂** (mode_003)

### 3.2 四个大区域
- **印前** (region_001) - 对应ERP"印前处理分值"
- **印中** (region_002) - 对应ERP"印中制作分值"
- **印后** (region_003) - 对应ERP"印后加工分值"
- **前台** (region_004) - 无绩效分

### 3.3 技能工资计算逻辑
```
员工某项小技能的工资计算：
├── 第一步：是否通过考核？（管理员手动设置）
│   ├── 未通过考核 → 0元
│   └── 通过考核 → 进入第二步
│
└── 第二步：是否在岗？（按大区域绩效自动判断）
    ├── 该技能所属大区域的绩效 ≥ 达标值 → 在岗工资
    └── 该技能所属大区域的绩效 < 达标值 → 不在岗工资
```

### 3.4 阶梯奖金计算
- 每个大区域有独立的阶梯规则
- 按区间累计计算，区间内按比例
- 示例：绩效7万，在3-10万区间，比例=(7-3)/(10-3)=4/7

---

## 四、当前数据状态

### 4.1 已导入员工（19人）
张lei、曾云、陈晓乾、林芝、李林、微店公用账户、黄荣华、周行、陈丹枫、龙永军、彭春春、郜一哲、韩思逸、赵健、周浪、黄静波、晏丽、黄莎、田凤娟

### 4.2 已导入绩效
- 月份：2025-12（实际是11月数据）
- 记录数：19条

### 4.3 预置技能（10个门店技能）
文本标准化、基础CAD标准化、高级CAD标准化、初级仿制、操机打印、设备维护、图纸处理、简装精装、特殊工艺、接待票据

---

## 五、待修改/优化的问题

### 5.1 已知问题

| 问题 | 优先级 | 说明 |
|-----|--------|------|
| ~~员工编辑切换问题~~ | 高 | 已修复，使用form+动态key |
| 小技能数据不完整 | 中 | 目前只有10个门店技能，需要导入中央工厂和喷印工厂的技能 |
| 员工-技能关联为空 | 中 | 需要给员工分配技能并设置考核状态 |
| 绩效计算结果全为0 | 中 | 因为没有员工-技能关联，技能工资都是0 |

### 5.2 后续开发计划

#### 短期（下次对话）
1. 根据技能.xlsx导入完整的小技能数据（中央工厂、喷印工厂）
2. 完善阶梯规则配置（目前是示例数据）
3. 给员工批量分配技能
4. 测试完整的绩效计算流程

#### 中期
1. 实现绩效计算结果验证（与历史数据对比）
2. 优化导出Excel格式
3. 添加数据校验和错误提示

#### 长期
1. 接入PostgreSQL数据库
2. 部署到Mac Mini服务器
3. 添加用户权限管理

---

## 六、技能表结构（来自技能.xlsx）

### 6.1 门店模式
```
印前：文本标准化、基础CAD标准化、高级CAD标准化、初级仿制
印中：操机打印、设备维护
印后：图纸处理、简装精装、特殊工艺
前台：接待票据、图纸商务业务、印刷业务、广告业务、管理调配、送货推广
```

### 6.2 中央工厂模式
```
印前：CAD导pdf、拼板、特殊装订文本、刀板、初级仿制
印中：文本、图纸、设备维护
印后：图纸处理、软装、裁切、硬装、设备简单处理
材料熟悉：纸张、工艺材料、常用包装材料
前台：网络/现场接单、收银结算开票、快印物料、图纸业务、商务业务、印刷/快印业务
供应链、送货
```

### 6.3 喷印工厂模式
```
印前：cdr/pdf导图、AI导图、文件拼版及生成刀版、cdr简单排版
印中-写真类：发图、常规打印
印中-平板：覆膜、裱板、雕刻、木工拼版雕刻、激光拼版雕刻
印后：后期粘接、广告物料个性美陈组合、全品类个性方案
机器维护：写真/平板/木工/激光机器维护保养维修
前台：接单、票据整理、广告物料报价、数码印刷物料接单、广告门头/定制类标识报价
岗位管理奖金：工厂生产内部管理
```

---

## 七、下次对话快速恢复

下次打开新对话时，输入：
```
先看一下1228第一次生成.md，继续上次的工作
```

主要任务：
1. 导入完整的小技能数据
2. 配置正确的阶梯规则
3. 给员工分配技能
4. 测试绩效计算

---

## 八、文件备份清单

| 文件 | 说明 |
|-----|------|
| 1226工作进度沟通.md | 初始需求文档 |
| 1228执行前的沟通.md | 详细需求确认 |
| 1228第一次生成.md | 本文件，开发进度备份 |
| data/*.json | 所有数据文件 |
| app/*.py | 所有代码文件 |
| 技能.xlsx | 技能表原始数据 |

---

*文档生成时间：2024年12月28日 16:45*
