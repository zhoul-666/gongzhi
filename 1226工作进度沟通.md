# 绩效核算系统 - 1226工作进度沟通

## 项目概述

为公司人事部开发一个**绩效核算工具**，用于每月计算生产岗位同事的绩效工资。

- **形式**：Streamlit 网页版
- **部署**：公司内网 Mac Mini 服务器
- **用户**：人事部 1 人，每月使用一次
- **人员规模**：约 30 人

---

## 一、Claude 协作规范（来自 re.md）

### 1. 沟通方式
- 用大白话解释，禁止使用专业术语（如"回调"、"装饰器"）
- 写代码前先讲清楚思路，确认后再动手
- 代码里加大量中文 `print()`，让程序"会说话"

### 2. 文件安全规范
- **相对路径**：禁止使用绝对路径（如 D:/...），只能用 `./data` 这种相对路径
- **自动备份**：任何涉及"写入"或"修改"文件的操作，代码中必须包含自动备份逻辑
  - 备份目录：`./backup`
  - 命名格式：`原文件名_YYYYMMDD_HHMMSS_v版本.扩展名`
- **版本管理**：代码头部必须包含 `__version__` 变量，每次修改需更新

### 3. 错误处理
- 关键功能必须用 try-except 包裹
- 报错时输出中文人话提示，而非英文代码
- 需要安装第三方库时，必须在显著位置给出 `pip install xxx` 命令

### 4. 复杂公式处理流程
- 用户把表格放进项目文件夹
- Claude 读取表格后，用户用口语一条一条解释
- Claude 理解后复述确认，确认对了再写代码

---

## 二、上级指示核心要求

### 交付物标准（4个特征）
1. **可验证**：先不动数据库，先跑通算法，输出 Excel 做人工对账验证
2. **可配置**：绩效/计薪规则不是死公式，能通过配置组合出不同岗位的口径
3. **可接入**：验证通过后，再接入 PostgreSQL，把结果喂给现有系统
4. **可交接**：任何人拿到文档与验收数据，都能复现结果、继续迭代

### 交付物清单
- 《工资核算需求说明（简版）》
- 《工资数据字典》
- 《核算流程图》
- 《规则配置说明》
- 《规则样例集》
- 可运行的核算程序
- 《验收数据包》

### 实施路线
1. **先做核算引擎**，别急着上数据库
2. **把绩效当成最重要的子程序**，模块化设计
3. **验证通过后再接入公司系统**

---

## 三、系统需求详细整理（1226沟通确定）

### 1. 员工管理

| 字段 | 说明 |
|-----|------|
| 系统ID | 自动生成，永不改变，用于历史数据追溯 |
| 工号 | 管理员可修改的显示编号 |
| 姓名 | 员工姓名 |

**设计要点**：
- 用"双编号"机制解决工号修改导致历史数据混乱的问题
- 页面显示"工号"，历史记录绑定"系统ID"

### 2. 大区域管理

目前有三个大区域：**印前、印中、印后**（可增删改）

每个大区域有独立的**阶梯规则**：

```
示例：印前的阶梯规则
├── < 3W（不在岗）：固定值（如100元）
├── ≥ 3W（在岗基础）：固定值（如200元）
├── 3W → 10W：区间总价值 500元（按比例计算）
├── 10W → 20W：区间总价值 400元（按比例计算）
├── 20W → 30W：区间总价值 300元（按比例计算）
└── > 30W：封顶，不再增加
```

**阶梯计算方式**：
- 绩效分在区间内按比例折算
- 例：绩效分7W，在3W-10W区间内，得分比例 = (7-3)/(10-3) = 4/7
- 该区间奖金 = 500 × 4/7 ≈ 285.7元

**设计要点**：
- 每个大区域的阶梯规则独立设置
- 管理员可在后台自由配置：区间起点、区间终点、区间价值
- 大区域的阶梯规则对所有员工统一，不做个性化

### 3. 小技能管理

小技能归属于大区域，例如：
```
印前
├── 设计
├── 制版
├── 拼版
└── ...

印中
├── 上机
├── 调色
└── ...

印后
├── ...
└── ...
```

每个小技能的属性：

| 属性 | 说明 |
|-----|------|
| 技能名称 | 如"设计"、"上机" |
| 所属大区域 | 印前/印中/印后 |
| 等级设置 | 大多数只有"在岗/不在岗"，部分有"初级/高级" |
| 各等级工资 | 如：不在岗50元、初级80元、高级120元 |
| 默认达标值 | 判断在岗的绩效分阈值（系统默认值） |

**设计要点**：
- 小技能只算固定工资，不参与阶梯计算
- 小技能的工资累加后，作为该大区域的"基础工资"
- 等级由管理员设定，相对稳定，不是每月变动

### 4. 员工-技能指派

给员工分配技能，并设置等级：

```
员工：张三
├── 印前-设计：高级（跟随系统达标值3W）
├── 印前-制版：初级（跟随系统达标值3W）
└── 印中-上机：在岗（手动指定达标值2W）← 兼职情况
```

**特殊情况处理——兼职员工**：
- 场景：前台同事在忙时帮忙做印前/印后
- 需求：他们的"达标值"应该比正式员工低
- 解决方案：
  - 默认"跟随系统"使用统一达标值
  - 可关闭"跟随系统"，手动指定该员工该技能的达标值
  - 工资金额不做个性化，使用系统统一值

### 5. 绩效分数据

- **来源**：从 ERP 系统导出 Excel
- **颗粒度**：按大区域（印前多少分、印中多少分、印后多少分）
- **不是**：按小技能分开

### 6. 计算流程

```
第一步：导入 ERP 绩效分（按大区域）
        └── 张三：印前 15W分，印中 8W分

第二步：计算小技能基础工资
        └── 遍历张三的每个小技能
        └── 根据绩效分判断在岗/不在岗（使用各自的达标值）
        └── 累加各技能工资
        └── 张三印前小技能合计：200元
        └── 张三印中小技能合计：100元

第三步：计算大区域绩效奖金
        └── 印前15W分 → 按印前阶梯规则 → 900元
        └── 印中8W分 → 按印中阶梯规则 → 600元

第四步：汇总
        └── 张三印前 = 200 + 900 = 1100元
        └── 张三印中 = 100 + 600 = 700元
        └── 张三总技能工资 = 1100 + 700 = 1800元
```

---

## 四、后台管理页面规划

| 页面 | 功能 |
|-----|------|
| 员工管理 | 增删改员工、修改工号 |
| 大区域管理 | 增删改区域、配置每个区域的阶梯规则 |
| 小技能管理 | 增删改技能、设置等级和金额、归属哪个大区域、设置默认达标值 |
| 员工技能指派 | 给员工分配技能、设置等级、可选手动指定达标值 |
| 绩效导入 | 上传 ERP 导出的 Excel |
| 绩效计算 | 一键计算、显示结果、导出 Excel |
| 历史查询 | 查看往月数据 |

---

## 五、实施计划

### 第一阶段：基础数据管理（核心框架）

**目标**：搭建可运行的 Streamlit 网页，能管理员工、大区域、小技能

**步骤**：
1. 创建项目目录结构
2. 设计数据存储方案（先用 JSON/CSV，后期可迁移数据库）
3. 实现员工管理页面（增删改查）
4. 实现大区域管理页面（含阶梯规则配置）
5. 实现小技能管理页面（含等级和金额设置）
6. 实现员工-技能指派页面（含个性化达标值）

### 第二阶段：核算引擎

**目标**：实现绩效计算逻辑，输出 Excel 可供人工验证

**步骤**：
1. 实现绩效分导入（解析 ERP Excel）
2. 实现小技能在岗判断逻辑
3. 实现大区域阶梯计算逻辑
4. 实现汇总计算
5. 实现结果导出 Excel
6. 用历史数据验证正确性

### 第三阶段：历史记录与完善

**目标**：保存历史数据，支持查询对比

**步骤**：
1. 设计历史数据存储结构
2. 每月计算后自动归档
3. 实现历史查询页面
4. 支持月度对比

### 第四阶段：接入生产环境（待验证通过后）

**目标**：接入 PostgreSQL，部署到 Mac Mini

**步骤**：
1. 确认服务器数据库类型
2. 数据迁移脚本
3. 部署与测试

---

## 六、待确认/待提供事项

| 事项 | 状态 |
|-----|------|
| ERP 导出的绩效分 Excel 样本（可脱敏） | ⏳ 待提供 |
| 现有的技能列表和工资标准 | ⏳ 待提供 |
| 服务器数据库类型确认 | ⏳ 待确认 |

---

## 七、项目文件说明

| 文件 | 说明 |
|-----|------|
| `re.md` | 合作规范文件 |
| `项目沟通记录.md` | 12月24日初次沟通记录 |
| `最新上级指示.md` | 上级对项目的要求和期望 |
| `1226工作进度沟通.md` | 本文件，12月26日详细需求整理 |

---

*下次对话时，让 Claude 先读取本文件，即可快速了解项目完整需求和进度。*
