# 工作进度记录

**最后更新**: 2026-01-05

---

## 本次工作内容 (2026-01-05)

### 已完成的修改

#### 1. 新增自定义在岗价格（奖金）功能
- **需求**：某些员工技能更好，值得给更高的价格
- **数据结构**：在 `employee_skills` 中新增字段
  ```json
  {
    "use_system_price": true,      // 是否用默认价格
    "custom_price_on_duty": null   // 自定义在岗价格
  }
  ```
- **涉及文件**：
  - `app/pages/assignment_page.py` - 增加奖金设置选项
  - `app/pages/calculate_page.py` - 计算时优先使用自定义价格
  - `app/data_manager.py` - 新分配技能时包含价格字段

#### 2. requirements.txt 补充依赖
- 添加了 `streamlit-aggrid>=0.3.4`，修复线上部署报错问题

#### 3. 全局 selectbox 不可编辑
- **文件**: `app/main.py`
- **内容**: 添加 CSS 禁用所有下拉框的输入功能，只能点击选择

#### 4. 技能指派页面优化 (`app/pages/assignment_page.py`)
- 增加"所属模式"筛选下拉框，选择后过滤员工列表
- **已分配技能**：改为三列网格卡片布局，按区域分组
- **分值/奖金设置**：改为紧凑的一行式布局
  ```
  分值    ○默认  ○自定义
  奖金    ○默认  ○自定义
  ```

#### 5. 工作区域管理修复 (`app/pages/region_page.py`)
- 修复 ERP 列名显示错误（印中/印后/前台都显示"印前处理分值"）
- 原因：`key` 是固定的，切换区域时不更新
- 解决：将 `key="edit_erp_column"` 改为 `key=f"erp_{selected_region_id}"`

#### 6. 工作技能管理优化 (`app/pages/skill_page.py`)
- 批量操作按钮重新对齐：
  - 第一行：全选、取消全选
  - 第二行：批量在岗、应用在岗、批量不在岗、应用不在岗（四列对齐）
- 技能列表从一行一条改为两列网格布局，更紧凑

---

## 本次修改的文件清单

| 文件 | 修改内容 |
|------|----------|
| `requirements.txt` | 添加 streamlit-aggrid |
| `app/main.py` | 添加 selectbox 不可编辑的 CSS |
| `app/pages/assignment_page.py` | 模式筛选 + 网格布局 + 奖金设置 |
| `app/pages/calculate_page.py` | 支持自定义价格计算 |
| `app/pages/region_page.py` | 修复 ERP 列名 key |
| `app/pages/skill_page.py` | 批量操作对齐 + 两列布局 |
| `app/data_manager.py` | 新增价格相关字段 |

---

## Git 提交记录

```
bad83e3 260105-界面优化与自定义价格功能
606c08e 260103-技能指派简化与全选修复
651d932 260101-计算与历史修改
```

---

## 下一步计划

### 待完成功能
1. 收集实际的阶梯规则数值
2. 给员工批量分配技能并设置考核状态
3. 与历史数据对比验证计算结果
4. 接入 PostgreSQL 数据库
5. 部署到 Mac Mini 服务器

### 可能需要优化的界面
- 员工管理页面的"编辑员工"部分布局
- 绩效导入页面的列映射交互

---
