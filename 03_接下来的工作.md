# 绩效核算系统 - 接下来的工作

> **说明**：记录待完成的任务和开发计划

---

## 最近更新（2026-01-03）

### 今日完成的工作

1. **修复技能列表全选按钮**
   - 问题：点击"全选"按钮后，下面的复选框没有被选中
   - 原因：Streamlit checkbox 有自己的内部状态，与 session_state 不同步
   - 解决：使用版本号机制强制刷新 checkbox

2. **简化技能指派页面**
   - 删除员工"全职/兼职"标记功能
   - 删除底部"自定义达标值设置"区域
   - **改为：每个已分配技能旁边直接显示达标值设置**
   - 新布局：技能名称 + 考核状态 + 达标值（系统/自定义）+ 输入框
   - 一个页面就能完成所有设置，不需要跑多个页面

3. **涉及修改的文件**
   - `app/pages/skill_page.py` - 全选按钮修复
   - `app/pages/assignment_page.py` - 重构技能指派页面
   - `app/pages/employee_page.py` - 删除员工类型选择
   - `app/data_manager.py` - 删除 employee_type 参数

---

## 历史更新（2026-01-01）

1. **界面全面改造（v2.0.0）**
   - 首页改为卡片式导航（8个功能入口）
   - 蓝色活力配色主题（#1E88E5）
   - 隐藏侧边栏，使用"返回首页"按钮导航
   - 4个统计卡片（员工数、技能数、历史记录、本月核算状态）

2. **绩效计算页面优化**
   - 改用 AgGrid 表格，支持点击展开行查看明细
   - 添加自定义保存名称功能（支持对比不同方案，如"2024-12-方案一"）

3. **历史查询页面优化**
   - 改用 AgGrid 表格，与绩效计算页面风格统一
   - 去掉货币符号 ¥，直接显示数字

4. **名称和标签优化**
   - "大区域" → "工作区域"
   - "小技能" → "工作技能"
   - 阶梯规则："最小值/最大值" → "从/到"

---

## 短期任务

### 1. 完善阶梯规则配置
- 目前阶梯规则是示例数据
- 需要人事提供实际的阶梯规则数值
- 涉及文件：`data/regions.json`

### 2. 给员工批量分配技能
- 需要给员工分配技能并设置考核状态
- **重要**：只有 `passed_exam = true` 的技能才会计算工资
- 涉及页面：员工技能指派

### 3. 测试完整的绩效计算流程
- 导入绩效数据
- 执行计算
- 验证结果是否正确

### 4. 与历史数据对比验证
- 拿之前人工计算的结果做对比
- 找出差异并修正逻辑

---

## 中期任务

### 1. 优化导出Excel格式
- 调整列宽、格式
- 添加汇总行

### 2. 添加数据校验
- 导入时检查数据完整性
- 计算前检查员工技能配置

### 3. 继续优化用户体验
- 根据使用反馈调整界面

---

## 长期任务

### 1. 接入PostgreSQL数据库
- 确认服务器数据库类型
- 设计数据迁移方案
- 实现数据库存储

### 2. 部署到Mac Mini服务器
- 配置服务器环境
- 部署应用
- 接入公司内网系统

### 3. 添加用户权限管理
- 与公司内网系统对接
- 实现权限控制

---

## 待确认/待提供事项

| 事项 | 说明 | 状态 |
|-----|------|------|
| 实际的阶梯规则数值 | 每个工作区域的区间和奖金 | 待人事提供 |
| 员工技能分配表 | 哪个员工有哪些技能 | 待人事提供 |
| 历史计算结果 | 用于验证系统计算正确性 | 待提供 |
| 服务器数据库类型 | PostgreSQL确认 | 待确认 |

---

## 已完成的里程碑

- [x] 第一阶段：基础数据管理
  - [x] 项目目录结构
  - [x] 数据存储（JSON格式）
  - [x] 员工管理页面
  - [x] 工作区域管理页面（含阶梯规则配置）
  - [x] 工作技能管理页面（含工资设置、批量编辑）
  - [x] 员工-技能指派页面（含考核状态）

- [x] 第二阶段：核算引擎（基本完成）
  - [x] 绩效分导入（解析ERP Excel）
  - [x] 在岗判断逻辑
  - [x] 阶梯计算逻辑
  - [x] 汇总计算
  - [x] 结果导出Excel
  - [x] AgGrid表格展示（支持展开明细）
  - [x] 自定义保存名称
  - [ ] 人工验证（进行中）

- [x] 第三阶段：历史记录
  - [x] 历史数据存储
  - [x] 历史查询页面（AgGrid展示）
  - [x] 月度对比功能

- [x] 第四阶段：界面改造（2026-01-01完成）
  - [x] 首页卡片式导航
  - [x] 蓝色活力配色
  - [x] 统一表格显示风格

- [ ] 第五阶段：生产部署
  - [ ] 接入PostgreSQL
  - [ ] 部署到Mac Mini

---

*最后更新：2026年01月03日*
