# 绩效核算系统 - 问题记录与解决

> **说明**：记录开发过程中遇到的问题及解决方案，供后续参考

---

## 问题列表

### 问题001：员工编辑切换问题
- **状态**：已解决
- **日期**：2024-12-28
- **描述**：切换员工时，编辑表单显示的还是上一个员工的数据
- **原因**：Streamlit 的 text_input 会缓存值，切换时不更新
- **解决**：使用 st.form 包装，并在 key 中加入员工 ID，切换员工时创建新的 form

---

### 问题002：selectbox 显示像可编辑输入框
- **状态**：已解决
- **日期**：2024-12-29
- **描述**：大区域管理、小技能管理的筛选器显示得像可编辑的输入框
- **解决**：将固定选项的 selectbox 改为 segmented_control（分段控制器）
- **涉及文件**：
  - `region_page.py` - 选择区域
  - `skill_page.py` - 按模式筛选、按区域筛选
  - `employee_page.py` - 按模式筛选

---

### 问题003：员工管理姓名工号不可编辑
- **状态**：已解决
- **日期**：2024-12-29
- **描述**：之前误解需求，把姓名工号改成完全不可编辑
- **原因**：用户原意是选择器样式不像输入框，但内容仍需可编辑
- **解决**：恢复 text_input 可编辑状态

---

### 问题004：中央工厂和喷印工厂技能不显示
- **状态**：已解决
- **日期**：2024-12-29
- **描述**：小技能管理页面筛选中央工厂或喷印工厂时，没有显示技能
- **原因**：skills.json 中只有门店的10个技能，中央工厂和喷印工厂的技能数据未导入
- **解决**：根据 1228执行前的沟通.md 中的技能列表，导入了48个技能（门店10个 + 中央工厂19个 + 喷印工厂19个）

---

### 问题005：绩效计算明细问题
- **状态**：已解决
- **日期**：2026-01-01
- **描述**：切换员工后界面消失，明细显示方式不够直观
- **解决**：改用 AgGrid 表格显示，支持点击展开查看详情（Master/Detail 模式）
- **涉及文件**：
  - `app/pages/calculate_page.py`
  - `app/pages/history_page.py`

---

### 问题006：修改代码后页面没有更新
- **状态**：已解决
- **日期**：2024-12-30
- **描述**：Claude 修改了代码文件，但刷新网页后看到的还是旧界面，误以为修改没成功
- **原因**：Streamlit 在开发模式下有时不会自动检测到文件变化，需要手动重启
- **解决**：修改代码后，需要重启 Streamlit 服务
- **操作方法**：
  ```bash
  # 杀掉当前进程并重启
  pkill -f "streamlit run"
  python3 -m streamlit run app/main.py --server.headless=true --server.port=8501
  ```
- **教训**：以后修改代码后，Claude 应该主动重启 Streamlit，而不是只让用户刷新页面

---

### 问题007：技能工资计算结果为0
- **状态**：已解决（需用户操作）
- **日期**：2026-01-01
- **描述**：给员工添加了所有技能，但绩效计算时技能工资全是0
- **原因**：员工技能关联表中 `passed_exam` 字段都是 `false`
- **解决**：需要在【员工技能指派】页面给每个技能勾选"通过考核"
- **说明**：只有 `passed_exam = true` 的技能才会计算工资

---

### 问题008：阶梯规则标签不清晰
- **状态**：已解决
- **日期**：2026-01-01
- **描述**：阶梯规则配置界面显示"最小值"和"最大值"，用户理解不够直观
- **解决**：改为"从"和"到"，更符合中文习惯（从X到Y奖励多少）
- **涉及文件**：`app/pages/region_page.py`

---

### 问题009：货币符号显示问题
- **状态**：已解决
- **日期**：2026-01-01
- **描述**：历史查询页面显示 ¥ 符号，用户不需要
- **解决**：去掉所有货币符号，直接显示数字
- **涉及文件**：`app/pages/history_page.py`

---

## 待解决问题汇总

| 编号 | 问题 | 优先级 | 状态 |
|-----|------|--------|------|
| - | 暂无待解决问题 | - | - |

---

*最后更新：2026年01月01日*
